<md-menu #menu="mdMenu">
  <button *ngIf="isSelf&&res.deleteFlag==='active'"
    (click)="del()"
    md-menu-item>
      削除
    </button>
</md-menu>

<md-card [ngClass]="{'res-pop':isPop}"
  class="res-container">
  <div class="res-left">
    <button type="button"
      md-icon-button
      (click)="uv()"
      [disabled]="isSelf||user.ud.getValue()===null">
        <md-icon [ngClass]="{'is-vote':res.voteFlag==='uv'}">keyboard_arrow_up</md-icon>
      </button>
    <button type="button"
      md-icon-button
      (click)="dv()"
      [disabled]="isSelf||user.ud.getValue()===null">
        <md-icon [ngClass]="{'is-vote':res.voteFlag==='dv'}">keyboard_arrow_down</md-icon>
      </button>
  </div>
  <div class="res-right">
    <div [ngClass]="{'res-self':isSelf,'res-reply':res.isReply&&!isSelf,'res-header':true}">
      <a (click)="isReply=!isReply">{{res.name}}</a>
      <a *ngIf="res.profile!==null"
        (click)="profileOpen()">[プロフィール]</a>
      <a class="app-link"
        [routerLink]="['/res',res.id]">{{res.date|atDate}}</a>
      <a (click)="hashClick()">
      HASH:{{res.hash.substr(0,6)}}...
    </a>
      <span class="action">
      <span>
      {{res.uv-res.dv}}ポイント
    </span>
      <button type="button"
        md-icon-button
        [mdMenuTriggerFor]="menu">
      <md-icon>keyboard_arrow_down</md-icon>
    </button>
      </span>
    </div>
    <div>
      <span class="action">
      <button *ngIf="res.reply!==null" (click)="sendReplyClick()" md-icon-button>
        <md-icon>send</md-icon>
      </button>
      <button (click)="receiveReplyClick()" *ngIf="res.replyCount!==0" md-icon-button>
        <md-icon>reply</md-icon>
        {{res.replyCount}}
      </button>
    </span>
      <div [innerHTML]="res.mdtext|html"
        class="markdown"></div>
    </div>
  </div>
  <md-card *ngIf="isReply&&user.ud.getValue()!==null">
    <app-res-write [topic]="res.topic"
      [reply]="res.id"
      (write)="isReply=false"></app-res-write>
  </md-card>
  <div *ngIf="children.size!==0">
    <md-card *ngIf="childrenMsg!==null"
      class="children-msg">
      <strong>{{childrenMsg}}</strong>
    </md-card>
    <app-res *ngFor="let c of children|reverse"
      [res]="c"
      (update)="childrenUpdate($event)"
      [isPop]="true"></app-res>
  </div>
</md-card>